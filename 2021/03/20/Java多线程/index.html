<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.1.1" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.1.1" type="image/png" sizes="32x32"><meta name="description" content="Java多线程                           Process与Thread        程序是指令和数据的有序集合，其本身没有任何运行的含义，是一个静态的概念。 而进程则是执行程序的一次执行过程，它是一个动态的概念。是系统资源分配的单位（程序的最小单位，是资源调度的最小单位） 通常在一个进程中可以包含若干个线程，当然一个进程中至少有一个线程，不然没有存">
<meta property="og:type" content="article">
<meta property="og:title" content="Java多线程">
<meta property="og:url" content="https://kingsirz123.github.io/2021/03/20/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/index.html">
<meta property="og:site_name" content="源一先生">
<meta property="og:description" content="Java多线程                           Process与Thread        程序是指令和数据的有序集合，其本身没有任何运行的含义，是一个静态的概念。 而进程则是执行程序的一次执行过程，它是一个动态的概念。是系统资源分配的单位（程序的最小单位，是资源调度的最小单位） 通常在一个进程中可以包含若干个线程，当然一个进程中至少有一个线程，不然没有存">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://kingsirz123.github.io/2021/03/20/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/1.png">
<meta property="article:published_time" content="2021-03-20T09:21:30.908Z">
<meta property="article:modified_time" content="2021-03-21T09:04:33.264Z">
<meta property="article:author" content="源一">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kingsirz123.github.io/2021/03/20/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/1.png"><title>Java多线程 | 源一先生</title><link ref="canonical" href="https://kingsirz123.github.io/2021/03/20/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.1.1"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 4.2.1"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Home</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archives</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">Categories</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">Tags</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">源一先生</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Java多线程</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2021-03-20</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2021-03-21</span></span></div></header><div class="post-body">
        <h1 id="Java多线程"   >
          <a href="#Java多线程" class="heading-link"><i class="fas fa-link"></i></a>Java多线程</h1>
      
        <h3 id="Process与Thread"   >
          <a href="#Process与Thread" class="heading-link"><i class="fas fa-link"></i></a>Process与Thread</h3>
      <ul>
<li><strong>程序是指令和数据的有序集合</strong>，其本身没有任何运行的含义，是一个<strong>静态的概念</strong>。</li>
<li>而<strong>进程则是执行程序的一次执行过程</strong>，它是一个<strong>动态的概念</strong>。<strong>是系统资源分配的单位</strong>（<strong>程序的最小单位，是资源调度的最小单位</strong>）</li>
<li>通常在<strong>一个进程中可以包含若干个线程</strong>，当然一个进程中至少有一个线程，不然没有存在的意义。<strong>线程是CPU调度和执行的的单位。</strong></li>
<li>注意:很多多线程是模拟出来的，<strong>真正的多线程是指有多个cpu，即多核，如服务器</strong>。如果是模拟出来的多线程，即在一个cpu的情况下，在同一个时间点，cpu只能执行一个代码，因为<strong>切换的很快，所以就有同时执行的错局</strong>。</li>
</ul>
<a id="more"></a>




        <h3 id="核心概念"   >
          <a href="#核心概念" class="heading-link"><i class="fas fa-link"></i></a>核心概念</h3>
      <ul>
<li>线程就是<strong>独立的执行路径</strong>;</li>
<li>在程序运行时，即使没有自己创建线程，后台也会有多个线程，如主线程，gc线程;</li>
<li><strong>main()称之为主线程，为系统的入口</strong>，用于执行整个程序;</li>
<li>在一个进程中，如果开辟了多个线程，<strong>线程的运行由调度器安排调度</strong>，调度器是与操作系统紧密相关的，先<strong>后顺序是不能认为的干预的</strong>。</li>
<li>对同一份资源操作时，会存在资源抢夺的问题，需要加入<strong>并发控制</strong>;</li>
<li>线程会带来<strong>额外的开</strong>销，如cpu调度时间，并发控制开销。</li>
<li>每个线程在自己的工作<strong>内存交互，内存控制不当会造成数据不一致</strong></li>
</ul>

        <h2 id="线程创建"   >
          <a href="#线程创建" class="heading-link"><i class="fas fa-link"></i></a>线程创建</h2>
      <ul>
<li>三种创建方式<ul>
<li>Thread class（继承Thread类(重点)  启动线程：子类对象.start(),<strong>不建议使用：避免OOP单继承局限性</strong>）</li>
<li>Runnable接口（实现Runnable接口(重点)  启动线程:传入目标对象+Thread对象.start()  推荐使用:避免单继承局限性，灵活方便,<strong>方便同一个对象被多个线程使用</strong>）（Thread(对象名，“线程名称”)）</li>
<li>Callable接口（实现Callable接口（了解)）</li>
</ul>
</li>
</ul>

        <h3 id="方式一："   >
          <a href="#方式一：" class="heading-link"><i class="fas fa-link"></i></a>方式一：</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建线程方式一:继承Thread类，重写run()方法，调用start开启线程</span></span><br><span class="line"><span class="comment">//总结:注意,线程开启不一定立即执行,由cPU调度执行</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThread1</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//run方法线程体</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;</span><br><span class="line">            system.out.println(<span class="string">"我在看代码--—"</span><span class="string">"+i) ;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">   public static void main(string[] args)&#123;</span></span><br><span class="line"><span class="string">       // main线程,主线程</span></span><br><span class="line"><span class="string">       // 创建一个线对象</span></span><br><span class="line"><span class="string">       TestThread1 testThread1 = new TestThread1( ;</span></span><br><span class="line"><span class="string">       //调用start()方法开启线程</span></span><br><span class="line"><span class="string">       testThreadi.start();                              for (int i = 0; i &lt; 1000; i++) &#123;</span></span><br><span class="line"><span class="string">           system.out.println("</span>我在学习多线程-—<span class="string">""</span>+i) ;</span><br><span class="line">       &#125;            </span><br><span class="line">   &#125;                            </span><br><span class="line">&#125;<span class="comment">//交替出现</span></span><br></pre></td></tr></table></div></figure>




        <h3 id="练习Thread，实现多线程同步下载图片"   >
          <a href="#练习Thread，实现多线程同步下载图片" class="heading-link"><i class="fas fa-link"></i></a>练习Thread，实现多线程同步下载图片</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TestThread</span><span class="params">(String url,String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name=name;</span><br><span class="line">        <span class="keyword">this</span>.url=url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Webdown we=<span class="keyword">new</span> Webdown();</span><br><span class="line">        we.downloader(url,name);</span><br><span class="line">        System.out.println(<span class="string">"下载了文件:"</span>+name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TestThread t1=<span class="keyword">new</span> TestThread(<span class="string">"https://p1.ssl.qhimgs1.com/sdr/400__/t01fff3e327dfefd757.jpg"</span>,<span class="string">"小兔子.jpg"</span>);</span><br><span class="line">        TestThread t2=<span class="keyword">new</span> TestThread(<span class="string">"https://p.ssl.qhimg.com/sdm/420_207_/t016d0fa3c28f6468b7.jpg"</span>,<span class="string">"樱花.jpg"</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Webdown</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">downloader</span><span class="params">(String url,String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtils.copyURLToFile(<span class="keyword">new</span> URL(url),<span class="keyword">new</span> File(name));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">"问题"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="方式2："   >
          <a href="#方式2：" class="heading-link"><i class="fas fa-link"></i></a>方式2：</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建线程方式2：实现runnable接口,重写run方法,执行线程需要丢入runnable接口实现类,调用start方法.</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThread3</span> <span class="keyword">implements</span> <span class="title">Runnablet</span></span>&#123;         <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//run方法线程体</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=e; i&lt; <span class="number">200</span>; i++)&#123;</span><br><span class="line">        System.out.printIn(<span class="string">"我在看代码---"</span>+i);</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">            <span class="comment">//创建runnbale接口的实现类对象</span></span><br><span class="line">            TestThread3 testThread3 = <span class="keyword">new</span> TestThread3():</span><br><span class="line">            <span class="comment">//创建线程对象,通过线程对象来开启我们的线程,代理</span></span><br><span class="line"><span class="comment">//            thread thread = new Thread(testThread3);</span></span><br><span class="line"><span class="comment">//            thread.start(): 1</span></span><br><span class="line">         <span class="keyword">new</span> Thread(testThread3).start();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=g: i s <span class="number">1000</span>; i++)&#123;</span><br><span class="line">                System.out.printIn(<span class="string">"我在学习多线程-"</span>+i);&#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="多个线程操作同一个对象"   >
          <a href="#多个线程操作同一个对象" class="heading-link"><i class="fas fa-link"></i></a>多个线程操作同一个对象</h3>
      <ul>
<li><strong>多个线程操作同一个资源的精况下,线程不安全，数据紊乱。</strong></li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//多个线程同时操作同一个对象</span></span><br><span class="line"><span class="comment">//买火车票的例子</span></span><br><span class="line"><span class="comment">//发现问题;多个线程操作同一个资源的精况下,线程不安全，数据紊乱。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThread4</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ticketNums = <span class="number">10</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ticketNums&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;              </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//模拟延时</span></span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                Thread.sleep(millis: <span class="number">200</span>);&#125;<span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printstackTrace() ;</span><br><span class="line">            &#125;</span><br><span class="line">                                                           System.out.println(Thread.currentThread() .getName()+<span class="string">"--&gt;拿到了第"</span>+ticketNums--+<span class="string">"票"</span>);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(string[]args)</span></span>&#123;</span><br><span class="line">        TestThread4 ticket = <span class="keyword">new</span> TestThread4( );</span><br><span class="line">        <span class="keyword">new</span> Thread(ticket , name:<span class="string">"小明"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(ticket, name:<span class="string">"老师"</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(ticket , name:<span class="string">"黄牛党"</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="龟兔赛跑"   >
          <a href="#龟兔赛跑" class="heading-link"><i class="fas fa-link"></i></a>龟兔赛跑</h3>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//龟兔赛跑 实例</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1 自定义一个boolean方法 决出胜利者</span></span><br><span class="line"><span class="comment"> * 2 将逻辑代码放入 线程体run方法中</span></span><br><span class="line"><span class="comment"> * 3 开启乌龟、兔子两条线程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">game</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Race race = <span class="keyword">new</span> Race();</span><br><span class="line">      <span class="keyword">new</span> Thread(race, <span class="string">"兔子"</span>).start();</span><br><span class="line">      <span class="keyword">new</span> Thread(race, <span class="string">"乌龟"</span>).start();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Race</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">int</span> steps = <span class="number">10000</span>;</span><br><span class="line">   <span class="keyword">public</span> String winner;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">while</span> (steps &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="keyword">if</span> (Thread.currentThread().getName().equals(<span class="string">"兔子"</span>)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">               Thread.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">boolean</span> flag = gameover(steps);</span><br><span class="line">         <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//没到终点就继续跑</span></span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">"跑了"</span> + steps-- + <span class="string">"步"</span>);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//决出胜利者=</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">gameover</span><span class="params">(<span class="keyword">int</span> step)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (winner != <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="comment">//已经产生了胜利者</span></span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (step &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">         winner = Thread.currentThread().getName();</span><br><span class="line">         System.out.println(winner + <span class="string">"赢了"</span>);</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="实现Callable-了解"   >
          <a href="#实现Callable-了解" class="heading-link"><i class="fas fa-link"></i></a>实现Callable(了解)</h3>
      <ul>
<li>1．实现Callable接口，<strong>需要返回值类型</strong></li>
<li>2．<strong>重写call方法，需要抛出异常</strong></li>
<li>3．<strong>创建目标对象</strong></li>
<li>4．创建执行服务:ExecutorService ser = Executors.newFixedThreadPool(1);</li>
<li>5．提交执行:Future<Boolean> result1 = ser.submit(t1);</li>
<li>6．获取结果: boolean r1 = result1.get()</li>
<li>7．关闭服务: ser.shutdownNow();</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//多线程下载图片</span></span><br><span class="line"><span class="comment">//实现图片的下载要先导入common-io的jar包</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCallable</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">      <span class="comment">//执行线程</span></span><br><span class="line">      downThread t1 = <span class="keyword">new</span> downThread(<span class="string">"https://img-bss.csdnimg.cn/1615183593661.png"</span>,<span class="string">"a.jpg"</span>);</span><br><span class="line">      downThread t2= <span class="keyword">new</span> downThread(<span class="string">"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fa0.att.hudong.com%2F30%2F29%2F01300000201438121627296084016.jpg&amp;refer=http%3A%2F%2Fa0.att.hudong.com&amp;app=2002&amp;size=f9999,"</span> +</span><br><span class="line">            <span class="string">"10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1618125226&amp;t=206ef43a6621700711f384e286ee4220"</span>,<span class="string">"b.jpg"</span>);</span><br><span class="line">      <span class="comment">//创建执行服务 开启线程池</span></span><br><span class="line">      ExecutorService ser= Executors.newFixedThreadPool(<span class="number">2</span>);</span><br><span class="line">      <span class="comment">//提交执行</span></span><br><span class="line">      Future&lt;Boolean&gt; future1=ser.submit(t1);</span><br><span class="line">      Future&lt;Boolean&gt; future2=ser.submit(t2);</span><br><span class="line">      <span class="comment">//获取结果</span></span><br><span class="line">      <span class="keyword">boolean</span> flag1= future1.get();</span><br><span class="line">      <span class="keyword">boolean</span> flag2= future2.get();</span><br><span class="line">      System.out.println(flag1);</span><br><span class="line">      System.out.println(flag2);</span><br><span class="line">      <span class="comment">//关闭服务</span></span><br><span class="line">      ser.shutdownNow();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">downThread</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Boolean</span>&gt; </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> String url;</span><br><span class="line">   <span class="keyword">public</span> String name;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">downThread</span><span class="params">(String url,String name)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.url=url;</span><br><span class="line">      <span class="keyword">this</span>.name=name;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Boolean <span class="title">call</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="comment">//执行体</span></span><br><span class="line">      webDownLoad webDownLoad = <span class="keyword">new</span> webDownLoad();</span><br><span class="line">      webDownLoad.photoDown(url,name);</span><br><span class="line">      System.out.println(name+<span class="string">"图片下载完成"</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">webDownLoad</span> </span>&#123;</span><br><span class="line">   <span class="comment">//定义下载图片的方法</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">photoDown</span><span class="params">(String url, String name)</span> </span>&#123;</span><br><span class="line">          <span class="comment">//借助封装的类 FileUtils 将该路径的图片 拷贝到指定文件</span></span><br><span class="line">      String file=<span class="string">"G:\\idea\\bilibili\\kuang\\Thread\\src\\com\\zz\\demo01"</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">//将网络路径 url 的资源下载到指定的文件夹中去，并命名为name</span></span><br><span class="line">         FileUtils.copyURLToFile(<span class="keyword">new</span> URL(url), <span class="keyword">new</span> File(file,name));</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="静态代理"   >
          <a href="#静态代理" class="heading-link"><i class="fas fa-link"></i></a>静态代理</h2>
      <figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//静态代理 多线程也是静态代理原理实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//真实角色</span></span><br><span class="line">        you you = <span class="keyword">new</span> you();</span><br><span class="line">        <span class="comment">//代理角色</span></span><br><span class="line">        Marry marry = <span class="keyword">new</span> WeddingCompany(you);</span><br><span class="line">        <span class="comment">//代理角色 帮助真实角色实现</span></span><br><span class="line">        marry.marride();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Marry</span></span>&#123;</span><br><span class="line">   <span class="comment">//定义一个结婚接口</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">marride</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//真实角色 结婚</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">you</span> <span class="keyword">implements</span> <span class="title">Marry</span></span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">marride</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"xxx结婚了"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//婚庆公司 帮助我实现结婚 婚庆公司可以在结婚前后增加所需要的业务</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WeddingCompany</span> <span class="keyword">implements</span> <span class="title">Marry</span></span>&#123;</span><br><span class="line">   <span class="comment">//引入真实角色</span></span><br><span class="line">   <span class="keyword">public</span> Marry target;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">WeddingCompany</span><span class="params">(Marry target)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.target=target;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">marride</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      before();</span><br><span class="line">      target.marride();</span><br><span class="line">      after();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"结婚前，进行场地的布置"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"结婚后，收拾东西回公司"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">结果：</span><br><span class="line">结婚前</span><br><span class="line">xxx结婚了</span><br><span class="line">结婚后</span><br></pre></td></tr></table></div></figure>


        <h4 id="静态代理模式总结："   >
          <a href="#静态代理模式总结：" class="heading-link"><i class="fas fa-link"></i></a>静态代理模式总结：</h4>
      <ul>
<li><p>真实对象和代理对象都要实现同一个接口</p>
</li>
<li><p>代理对象要代理真是角色</p>
</li>
<li><p>好处</p>
<ul>
<li>代理对象可以做很多真实对象做不了的事</li>
<li>真实对象专注做自己的事情</li>
</ul>
</li>
<li><p><strong>Thread底层也是通过静态代理原理实现的，Thread为代理角色，Runnable为真实角色，run为接口中的方法</strong></p>
</li>
</ul>

        <h2 id="线程方法"   >
          <a href="#线程方法" class="heading-link"><i class="fas fa-link"></i></a>线程方法</h2>
      <div class="table-container"><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>setPriority(int newPriority)</td>
<td>更改线程的<strong>优先级</strong></td>
</tr>
<tr>
<td>static void sleep(long millis)</td>
<td>在指定的毫秒内让正在执行的线程进入<strong>休眠</strong>状态</td>
</tr>
<tr>
<td>void join()</td>
<td><strong>等待该线程终止</strong></td>
</tr>
<tr>
<td>static void yield()</td>
<td><strong>暂停</strong>正在执行的线程对象，并执行其他的线程</td>
</tr>
<tr>
<td>void interrupt()</td>
<td><strong>中断</strong>线程，别使用这个方法</td>
</tr>
<tr>
<td>boolean isAlive()</td>
<td>测试线程是否处于活动状态</td>
</tr>
</tbody></table></div>

        <h3 id="停止线程"   >
          <a href="#停止线程" class="heading-link"><i class="fas fa-link"></i></a>停止线程</h3>
      <ul>
<li>建议线程正常停止—&gt;<strong>利用次数</strong>,不建议死循环。</li>
<li>建议使用<strong>标志位</strong>—&gt;设置—个标志位</li>
<li>不要使用stop或者destroy等过时或者JDK不建议使用的方法</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestStop</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">   <span class="keyword">boolean</span> flag=<span class="keyword">true</span>;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (flag)&#123;</span><br><span class="line">         System.out.println(<span class="string">"子线程"</span>+i++);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//标志位停止线程</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.flag=<span class="keyword">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      TestStop testStop = <span class="keyword">new</span> TestStop();</span><br><span class="line">      <span class="keyword">new</span> Thread(testStop).start();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">         System.out.println(<span class="string">"主线程"</span>+i);</span><br><span class="line">         <span class="keyword">if</span> (i==<span class="number">900</span>)&#123;</span><br><span class="line">            testStop.stop();</span><br><span class="line">            System.out.println(<span class="string">"线程停止。"</span>);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="线程休眠"   >
          <a href="#线程休眠" class="heading-link"><i class="fas fa-link"></i></a>线程休眠</h3>
      <ul>
<li>sleep (时间) 指定<strong>当前线程阻塞的毫秒数</strong>；</li>
<li>sleep存在异常<strong>InterruptedException</strong>；</li>
<li>sleep<strong>时间达到后线程进入就绪状态</strong>；</li>
<li>sleep可以<strong>模拟网络延时</strong>（<strong>放大问题的发生性</strong>），倒计时等。</li>
<li><strong>每一个对象都有一个锁</strong>，<strong>sleep不会释放锁</strong>；</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模拟网络延时 放大问题的发生性</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSleep</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">   <span class="comment">//模拟卖票</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">int</span> tickets=<span class="number">50</span>;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">while</span> (tickets&gt;<span class="number">0</span>)&#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">         System.out.println(Thread.currentThread().getName()+<span class="string">"买到了第"</span>+tickets--+<span class="string">"张票"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      TestSleep testSleep = <span class="keyword">new</span> TestSleep();</span><br><span class="line">      <span class="keyword">new</span> Thread(testSleep,<span class="string">"小明"</span>).start();</span><br><span class="line">      <span class="keyword">new</span> Thread(testSleep,<span class="string">"小王"</span>).start();</span><br><span class="line">      <span class="keyword">new</span> Thread(testSleep,<span class="string">"老张"</span>).start();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>





<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//模拟倒计时</span></span><br><span class="line"><span class="keyword">package</span> Theraddd;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeLeft</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        TimeLeft.dd();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">dd</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n=<span class="number">10</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            System.out.println(n--);</span><br><span class="line">            <span class="keyword">if</span>(n&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="线程礼让"   >
          <a href="#线程礼让" class="heading-link"><i class="fas fa-link"></i></a>线程礼让</h3>
      <ul>
<li>将线程<strong>从运行状态转为就绪状态</strong></li>
<li>让cpu重新调度，礼让不一定成功！看CPU心情</li>
<li>Thread.yield();</li>
</ul>

        <h3 id="join"   >
          <a href="#join" class="heading-link"><i class="fas fa-link"></i></a>join</h3>
      <ul>
<li>Join合并线程，待此线程执行完成后，再执行其他线程，其他线程阻塞</li>
<li>两个线程交替执行，当使用join()方法时，主线程停止等到子线程完成才继续执行。</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TheardJoin</span> <span class="keyword">implements</span>  <span class="title">Runnable</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">"子线程"</span>+i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">            TheardJoin testJoin = <span class="keyword">new</span> TheardJoin();</span><br><span class="line">            Thread thread = <span class="keyword">new</span> Thread(testJoin);</span><br><span class="line">            thread.start();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">500</span>; i++) &#123;</span><br><span class="line">                <span class="comment">//当我们主线程i==50时，让子线程进行一个插队</span></span><br><span class="line">                <span class="keyword">if</span> (i==<span class="number">50</span>)&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        thread.join();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">"主线程"</span>+i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="线程状态"   >
          <a href="#线程状态" class="heading-link"><i class="fas fa-link"></i></a>线程状态</h2>
      <img src="/2021/03/20/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/1.png" class="" title="线程状态">

<ul>
<li><ul>
<li><a href="https://www.kuangstudy.com/java/lang/Thread.State.html#NEW" target="_blank" rel="noopener"><code>NEW</code></a><br>线程尚未开始在这个国家。</li>
<li><a href="https://www.kuangstudy.com/java/lang/Thread.State.html#RUNNABLE" target="_blank" rel="noopener"><code>RUNNABLE</code></a><br>处于这种状态中的java虚拟机执行的线程。</li>
<li><a href="https://www.kuangstudy.com/java/lang/Thread.State.html#BLOCKED" target="_blank" rel="noopener"><code>BLOCKED</code></a><br>线程阻塞等待监控锁在这个国家。</li>
<li><a href="https://www.kuangstudy.com/java/lang/Thread.State.html#WAITING" target="_blank" rel="noopener"><code>WAITING</code></a><br>处于这种状态的线程被无限期地等待另一个线程来执行特定的动作。</li>
<li><a href="https://www.kuangstudy.com/java/lang/Thread.State.html#TIMED_WAITING" target="_blank" rel="noopener"><code>TIMED_WAITING</code></a><br>处于这种状态的线程正在等待另一个线程上执行一个动作指定的等待时间。</li>
<li><a href="https://www.kuangstudy.com/java/lang/Thread.State.html#TERMINATED" target="_blank" rel="noopener"><code>TERMINATED</code></a><br>处于这种状态的线程退出。</li>
</ul>
</li>
</ul>
<p>  一个线程可以在一个给定的时间点上只有一个状态。这些状态是不反映任何操作系统线程状态的虚拟机状态。</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThreadState</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Thread thread=<span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">         &#125;</span><br><span class="line">         System.out.println(<span class="string">"子线程"</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">//创建完对象后，观察线程的状态</span></span><br><span class="line">      Thread.State state = thread.getState();</span><br><span class="line">      System.out.println(state);</span><br><span class="line">      <span class="comment">//start后线程进入就绪状态</span></span><br><span class="line">      thread.start();</span><br><span class="line">      System.out.println(thread.getState());</span><br><span class="line">      <span class="keyword">while</span> (state!=Thread.State.TERMINATED)&#123;</span><br><span class="line">         <span class="comment">//若线程不死 就一直输出</span></span><br><span class="line">         <span class="comment">//等待状态说明执行中，出现了阻塞睡眠</span></span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            state=thread.getState();</span><br><span class="line">            System.out.println(state);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//线程停止之后不能再次运行，会出现异常</span></span><br><span class="line">         <span class="comment">//Exception in thread "main" java.lang.IllegalThreadStateException</span></span><br><span class="line">         <span class="comment">//at java.lang.Thread.start(Thread.java:708)</span></span><br><span class="line">         <span class="comment">//at com.zz.state.TestThreadState.main(TestThreadState.java:40)</span></span><br><span class="line">      <span class="comment">//thread.start();</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">输出结果：</span><br><span class="line">NEW</span><br><span class="line">RUNNABLE</span><br><span class="line">TIMED_WAITING</span><br><span class="line">TIMED_WAITING</span><br><span class="line">TIMED_WAITING</span><br><span class="line">TIMED_WAITING</span><br><span class="line">TIMED_WAITING</span><br><span class="line">TIMED_WAITING</span><br><span class="line">TIMED_WAITING</span><br><span class="line">TIMED_WAITING</span><br><span class="line">TIMED_WAITING</span><br><span class="line">子线程</span><br><span class="line">TERMINATED</span><br></pre></td></tr></table></div></figure>




        <h3 id="线程优先级"   >
          <a href="#线程优先级" class="heading-link"><i class="fas fa-link"></i></a>线程优先级</h3>
      <ul>
<li>Java提供一个线程调度器来监控程序中启动后进入就绪状态的所有线程，线程调度器按照优先级决定应该调度哪个线程来执行</li>
<li>线程的优先级用数字表示，范围从1~10.<ul>
<li>Thread.MIN_PRIORITY = 1;</li>
<li>Thread.MAX_PRIORITY = 10;</li>
<li>Thread.NORM_PRIORITY = 5;</li>
</ul>
</li>
<li>使用以下方式改变或获取优先级<ul>
<li>getPriority() . setPriority(int xxx)</li>
</ul>
</li>
<li>线程优先级<strong>最大设置为10</strong>，<strong>最小为1</strong>，不在这个范围内的都会报出异常</li>
<li>每一个程序都是主线程先执行，后执行子线程，<strong>默认线程优先级为5</strong></li>
<li><strong>优先级低只是意味着获得调度的概率低</strong>，并不是优先级低就不会被调用了，这都是看CPU的调度，也有可能低优先级的线程先调度（性能倒置）</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPriority</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(Thread.currentThread().getName()+<span class="string">"-----&gt;"</span>+Thread.currentThread().getPriority());</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"主线程优先级"</span>+Thread.currentThread().getPriority());</span><br><span class="line">      TestPriority testPriority = <span class="keyword">new</span> TestPriority();</span><br><span class="line">      Thread thread1=<span class="keyword">new</span> Thread(testPriority,<span class="string">"线程1"</span>);</span><br><span class="line">      thread1.setPriority(<span class="number">1</span>);</span><br><span class="line">      thread1.start();</span><br><span class="line">      Thread thread2=<span class="keyword">new</span> Thread(testPriority,<span class="string">"线程2"</span>);</span><br><span class="line">      thread2.setPriority(Thread.MAX_PRIORITY);<span class="comment">//10</span></span><br><span class="line">      thread2.start();</span><br><span class="line">      Thread thread3=<span class="keyword">new</span> Thread(testPriority,<span class="string">"线程3"</span>);</span><br><span class="line">      thread3.setPriority(<span class="number">3</span>);</span><br><span class="line">      thread3.start();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h3 id="守护（daemon）线程"   >
          <a href="#守护（daemon）线程" class="heading-link"><i class="fas fa-link"></i></a>守护（daemon）线程</h3>
      <ul>
<li>线程分为<strong>用户线程</strong>和<strong>守护线程</strong></li>
<li>虚拟机必须确保用户线程执行完毕</li>
<li><strong>虚拟机不用等待守护线程</strong>执行完毕 如<strong>gc线程</strong></li>
<li>如,后台记录操作日志,监控内存,垃圾回收等待..</li>
<li>设置为守护线程核心就是将线程的setDaemon(true)设置为true</li>
<li>当用户线程结束后，我们看到守护线程还在执行一段时间，原因是当我们销毁用户线程后也需要一段时间，因为cpu切换速度比较快，所以我们的守护线程也会运行一段时间。</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//守护线程</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDaemon</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      God god = <span class="keyword">new</span> God();</span><br><span class="line">      You you = <span class="keyword">new</span> You();</span><br><span class="line">      Thread thread = <span class="keyword">new</span> Thread(god);</span><br><span class="line">      <span class="comment">//将上帝设置为守护线程</span></span><br><span class="line">      <span class="comment">//默认为false,正常的线程都是用户线程</span></span><br><span class="line">      thread.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">      <span class="comment">//开启守护线程</span></span><br><span class="line">      thread.start();</span><br><span class="line">      <span class="keyword">new</span> Thread(you).start();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//上帝模拟守护线程</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">God</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">         System.out.println(<span class="string">"上帝一直保佑着你"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//用户线程</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">You</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">36500</span>; i++) &#123;</span><br><span class="line">         System.out.println(<span class="string">"hello world 第"</span>+i+<span class="string">"天"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(<span class="string">"GoodBy world"</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="线程同步"   >
          <a href="#线程同步" class="heading-link"><i class="fas fa-link"></i></a>线程同步</h2>
      
        <h3 id="并发和并行"   >
          <a href="#并发和并行" class="heading-link"><i class="fas fa-link"></i></a>并发和并行</h3>
      <p><strong>并发是两个队列交替使用</strong>，<strong>并行是两个队列同时使用两台咖啡机</strong>，<strong>如果串行，一个队列使用一台咖啡机</strong>，这效率最低的。</p>
<p><strong>并发</strong>（多线程操作同一个资源）</p>
<ul>
<li>CPU一核，模拟出来多条线程，天下武功，唯快不破，快速交替</li>
</ul>
<p><strong>并行</strong>（多个人一起行走）</p>
<ul>
<li>CPU多核，多个线程可以同时执行；提高性能可以用线程池</li>
</ul>
<p>并发编程的本质：<strong>充分利用CPU性能</strong></p>

        <h3 id="线程同步-1"   >
          <a href="#线程同步-1" class="heading-link"><i class="fas fa-link"></i></a>线程同步</h3>
      <ul>
<li><p>处理多线程问题时 , 多个线程访问同一个对象 , 并且某些线程还想修改这个对象 . 这时候我们就需要线程同步 . <strong>线程同步其实就是一种等待机制</strong> , 多个需要同时访问此对象的线程进入这个<strong>对象的等待池 形成队列</strong>, 等待前面线程使用完毕 , 下一个线程再使用</p>
</li>
<li><p>由于同一进程的多个线程共享同一块存储空间 , 在带来方便的同时,也带来了访问冲突问题 , 为了保证数据在方法中被访问时的正确性 , 在访问时加入 <strong>锁机制</strong></p>
<p><strong>synchronized</strong> , 当一个线程获得对象的排它锁 , 独占资源 , 其他线程必须等待 , 使用后释放锁即可 . 存在以下问题 :</p>
<ul>
<li><strong>一个线程持有锁</strong>会导致<strong>其他所有需要此锁的线程挂起</strong> ;</li>
<li><strong>在多线程竞争下</strong> , 加锁 , 释放锁会导致比较多的<strong>上下文切换 和 调度延时,引起性能问题</strong> ;</li>
<li>如果一个优先级高的线程等待一个优先级低的线程释放锁 会导致<strong>优先级倒置 , 引起性能问题</strong></li>
</ul>
</li>
</ul>

        <h4 id="同步方法"   >
          <a href="#同步方法" class="heading-link"><i class="fas fa-link"></i></a>同步方法</h4>
      <ul>
<li>由于我们可以通过 private 关键字来保证数据对象只能被方法访问 , 所以我们只需要针对方法提出一套机制 , 这套机制就是 synchronized 关键字 , 它包括两种用法 <strong>synchronized 方法</strong> 和<strong>synchronized 块</strong><ul>
<li>synchronized 方法 <strong>是我们共享的资源通过一个方法执行</strong> 同步方法 : public synchronized void method(int args) {}</li>
<li>synchronized 块 <strong>是我们共享的资源是一个对象</strong> 块 synchronized (accout){ }</li>
</ul>
</li>
<li>synchronized方法控制对 “对象” 的访问 , 每个对象对应一把锁 , <strong>每个synchronized方法都必须获得调用该方法的对象的锁才能执行 , 否则线程会阻塞</strong> , 方法<strong>一旦执行 , 就独占该锁</strong> , 直到该方法返回才释放锁 , 后面被阻塞的线程才能获得这个锁 , 继续执行</li>
</ul>
<p>缺陷 : 若将一个大的方法申明为synchronized 将会<strong>影响效率</strong>(<strong>方法里需要修改的资源才需要锁</strong>，锁的太多浪费资源)</p>

        <h4 id="同步块"   >
          <a href="#同步块" class="heading-link"><i class="fas fa-link"></i></a>同步块</h4>
      <ul>
<li>同步块 : synchronized (Obj ) { }</li>
<li>Obj 称之为 <strong>同步监视器</strong><ul>
<li>Obj 可以是任何对象 , 但是<strong>推荐使用共享资源作为同步监视器</strong></li>
<li>同步方法中无需指定同步监视器 , <strong>因为同步方法的同步监视器就是this , 就是这个对象本身 , 或者是 class</strong> [ 反射中讲解 ]</li>
</ul>
</li>
<li>同步监视器的执行过程<ul>
<li>第一个线程访问 , 锁定同步监视器 , 执行其中代码 .</li>
<li>第二个线程访问 , 发现同步监视器被锁定 , 无法访问 .</li>
<li>第一个线程访问完毕 , 解锁同步监视器 .</li>
<li>第二个线程访问, 发现同步监视器没有锁 , 然后锁定并访问</li>
</ul>
</li>
</ul>

        <h4 id="线程同步安全"   >
          <a href="#线程同步安全" class="heading-link"><i class="fas fa-link"></i></a>线程同步安全</h4>
      
        <h5 id="买票"   >
          <a href="#买票" class="heading-link"><i class="fas fa-link"></i></a>买票</h5>
      <p>这里多个线程资源抢占票，若不适用锁机制不同对象会抢到同一张票，还会造成票的负数，显然这是线程不安全的，那么我们使用<strong>synchronized方法实现线程安全</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//多个对象进行抢票 通过给票上锁来实现线程安全</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ticket</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      MyTicket myTicket = <span class="keyword">new</span> MyTicket();</span><br><span class="line">      <span class="keyword">new</span> Thread(myTicket).start();</span><br><span class="line">      <span class="keyword">new</span> Thread(myTicket).start();</span><br><span class="line">      <span class="keyword">new</span> Thread(myTicket).start();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTicket</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">int</span> tickets = <span class="number">20</span>;</span><br><span class="line">   <span class="keyword">boolean</span> flag=<span class="keyword">true</span>;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">         buy();</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">10</span>);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//synchronized 同步方法，锁的是 this MyTicket这个资源</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (tickets&lt;<span class="number">0</span>)&#123;</span><br><span class="line">         flag=<span class="keyword">false</span>;</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">         System.out.println(Thread.currentThread().getName() + <span class="string">"抢到了"</span> + tickets--);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h5 id="取钱（ACID补充）"   >
          <a href="#取钱（ACID补充）" class="heading-link"><i class="fas fa-link"></i></a>取钱（ACID补充）</h5>
      <p>两个线程进行取钱，取同一个账户，若不加锁两个线程会同时操控一个资源进行，会造成当a取钱时，b也同时进行取钱，就会造成ab同时消耗这个资源，会造成数据的脏读。<strong>使用代码块，锁住变化的对象账户accout</strong></p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模拟夫妻取钱，开启两个线程，同时取钱，一个账户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bannk</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Accout accout = <span class="keyword">new</span> Accout(<span class="number">100</span>,<span class="string">"卖废品"</span>);</span><br><span class="line">      MyThread myThread1 = <span class="keyword">new</span> MyThread(accout,<span class="number">50</span>);</span><br><span class="line">      myThread1.start();</span><br><span class="line">      MyThread myThread2 = <span class="keyword">new</span> MyThread(accout,<span class="number">50</span>);</span><br><span class="line">      myThread2.start();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Accout</span></span>&#123;</span><br><span class="line">   <span class="comment">//银行卡余额</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">int</span> money;</span><br><span class="line">   <span class="comment">//存钱备注</span></span><br><span class="line">   <span class="keyword">public</span> String name;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Accout</span><span class="params">(<span class="keyword">int</span> money, String name)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.money = money;</span><br><span class="line">      <span class="keyword">this</span>.name = name;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> Accout accout;</span><br><span class="line">   <span class="comment">//取的钱</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">int</span> quMoney;</span><br><span class="line">   <span class="comment">//手里的钱</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">int</span> nowMoney;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">MyThread</span><span class="params">(Accout accout, <span class="keyword">int</span> quMoney)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.accout = accout;</span><br><span class="line">      <span class="keyword">this</span>.quMoney = quMoney;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">boolean</span> flag=<span class="keyword">true</span>;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//锁的对象时变化的对象，这里若使用同步方法，指代this代表银行，明显不行</span></span><br><span class="line">      <span class="comment">//使用代码块，锁住变化的对象账户accout</span></span><br><span class="line">         <span class="keyword">synchronized</span> (accout)&#123;</span><br><span class="line">            <span class="comment">//判断取的钱 是否多余账户余额</span></span><br><span class="line">            <span class="keyword">if</span> (quMoney&gt;accout.money)&#123;</span><br><span class="line">               flag=<span class="keyword">false</span>;</span><br><span class="line">               System.out.println(Thread.currentThread().getName()+<span class="string">"取了"</span>+quMoney+<span class="string">"银行卡余额不足，仅剩"</span>+accout.money);</span><br><span class="line">               <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">               Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//正常取钱</span></span><br><span class="line">            accout.money=accout.money-quMoney;</span><br><span class="line">            nowMoney+=quMoney;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">"取了"</span>+quMoney+<span class="string">",手里:"</span>+nowMoney+<span class="string">",银行卡余额："</span>+accout.money);</span><br><span class="line">         &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h5 id="ArrayList"   >
          <a href="#ArrayList" class="heading-link"><i class="fas fa-link"></i></a>ArrayList</h5>
      <p>不安全原因是当两个线程同时执行的时候，将两个元素加到了同一个数组<strong>太快了后面会覆盖前面的元素</strong>,就会造成集合的长度小于10000，</p>
<p>Vector 是线程安全的</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">unSafeList</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      ArrayList&lt;Object&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">      <span class="comment">//Vector&lt;Object&gt; objects = new Vector&lt;&gt;();</span></span><br><span class="line">      <span class="comment">//不安全原因是当两个线程同时执行的时候，将两个元素加到了同一个数组</span></span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">               <span class="comment">//这里变化的资源是list所以锁住该对象</span></span><br><span class="line">               <span class="keyword">synchronized</span> (list)&#123;</span><br><span class="line"> list.add(Thread.currentThread().getName());</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">         &#125;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         Thread.sleep(<span class="number">10</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(<span class="string">"集合中大小："</span>+list.size());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="CopyOnWriteArrayList-线程安全"   >
          <a href="#CopyOnWriteArrayList-线程安全" class="heading-link"><i class="fas fa-link"></i></a>CopyOnWriteArrayList 线程安全</h4>
      <p>CopyOnWriteArrayList 是JUC下的一个方法，在java.util.concurrent.CopyOnWriteArrayList这个包下面</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//线程安全</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestConyOnWriteArraylist</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      CopyOnWriteArrayList&lt;Object&gt; list = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">         <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            list.add(Thread.currentThread().getName());</span><br><span class="line">         &#125;).start();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(list.size());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>



<p>源码分析 CopyOnWriteArrayList为什么是线程安全的</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CopyOnWriteArrayList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">RandomAccess</span>, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">8673264195747942595L</span>;</span><br><span class="line">    <span class="comment">/** The lock protecting all mutators */</span></span><br><span class="line">    <span class="comment">//这里使用了可重复锁，是JUC里面的锁，后面会讲到</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">transient</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    <span class="comment">/** The array, accessed only via getArray/setArray. */</span></span><br><span class="line">    <span class="comment">//使用了volatile关键字 保证了原子性</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Object[] array;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Gets the array.  Non-private so as to also be accessible</span></span><br><span class="line"><span class="comment">     * from CopyOnWriteArraySet class.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">final</span> Object[] getArray() &#123;</span><br><span class="line">        <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="死锁"   >
          <a href="#死锁" class="heading-link"><i class="fas fa-link"></i></a>死锁</h4>
      <ul>
<li>多个线程各自占有一些共享资源 , 并且互相等待其他线程占有的资源才能运行 , 而导致两个或者多个线程都在等待对方释放资源 , 都停止执行的情形 . 某一个同步块 同时拥有 “ <strong>两个以上对象的锁</strong> ” 时 , 就可能会发生 “ 死锁 ” 的问题 .</li>
</ul>
<p>代码示例 :</p>
<p>A B两个线程 a,b 两个资源 A首先拥有a资源，B首先拥有b资源；两个线程各自争夺对方手中的资源，产生死锁</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeadLock</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      DeadThread thread1= <span class="keyword">new</span> DeadThread(<span class="number">0</span>,<span class="string">"A"</span>);</span><br><span class="line">      thread1.start();</span><br><span class="line">      DeadThread thread2= <span class="keyword">new</span> DeadThread(<span class="number">1</span>,<span class="string">"B"</span>);</span><br><span class="line">      thread2.start();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//两个资源</span></span><br><span class="line"><span class="comment">//a</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Gun</span></span>&#123;</span><br><span class="line">   String name=<span class="string">"a"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//b</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Doll</span> </span>&#123;</span><br><span class="line">   String name = <span class="string">"b;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">class DeadThread extends Thread&#123;</span></span><br><span class="line"><span class="string">   static Gun gun=new Gun();</span></span><br><span class="line"><span class="string">   static Doll doll=new Doll();</span></span><br><span class="line"><span class="string">   int choice;</span></span><br><span class="line"><span class="string">   String name;</span></span><br><span class="line"><span class="string">   public DeadThread(int choice,String name)&#123;</span></span><br><span class="line"><span class="string">      this.choice=choice;</span></span><br><span class="line"><span class="string">      this.name=name;</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">   @Override</span></span><br><span class="line"><span class="string">   public void run() &#123;</span></span><br><span class="line"><span class="string">      makeup();</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">   public void makeup()&#123;</span></span><br><span class="line"><span class="string">      if (choice==0)&#123;</span></span><br><span class="line"><span class="string">         synchronized (gun)&#123;</span></span><br><span class="line"><span class="string">            System.out.println(Thread.currentThread().getName()+"</span>获得了----》<span class="string">"+gun.name+"</span>的锁<span class="string">");</span></span><br><span class="line"><span class="string">            //当走在这里的时候，小王也拿到了doll的锁并没有释放，</span></span><br><span class="line"><span class="string">            synchronized (doll)&#123;</span></span><br><span class="line"><span class="string">               System.out.println(Thread.currentThread().getName()+"</span>获得了----》<span class="string">"+gun.name+"</span>的锁<span class="string">");</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">         &#125;</span></span><br><span class="line"><span class="string">      &#125;else &#123;</span></span><br><span class="line"><span class="string">         synchronized (doll)&#123;</span></span><br><span class="line"><span class="string">            System.out.println(Thread.currentThread().getName()+"</span>获得了----》<span class="string">"+doll.name+"</span>的锁<span class="string">");</span></span><br><span class="line"><span class="string">            //这里小明一开始就拿到了 gun的锁并没有释放，故就产生了死锁</span></span><br><span class="line"><span class="string">            synchronized (gun)&#123;</span></span><br><span class="line"><span class="string">               System.out.println(Thread.currentThread().getName()+"</span>获得了----》<span class="string">"+gun.name+"</span>的锁<span class="string">");</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">         &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></div></figure>

<p>解决死锁</p>
<p>当小王想要抢小明手中枪的时候，必须等待对方释放锁后，才能拿得到，不在产生死锁</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Theraddd;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeadLock</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        DeadThread thread1= <span class="keyword">new</span> DeadThread(<span class="number">0</span>,<span class="string">"A"</span>);</span><br><span class="line">        thread1.start();</span><br><span class="line">        DeadThread thread2= <span class="keyword">new</span> DeadThread(<span class="number">1</span>,<span class="string">"B"</span>);</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//两个资源</span></span><br><span class="line"><span class="comment">//a</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Gun</span></span>&#123;</span><br><span class="line">    String name=<span class="string">"a"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//b</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Doll</span> </span>&#123;</span><br><span class="line">    String name = <span class="string">"b"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DeadThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> Gun gun=<span class="keyword">new</span> Gun();</span><br><span class="line">    <span class="keyword">static</span> Doll doll=<span class="keyword">new</span> Doll();</span><br><span class="line">    <span class="keyword">int</span> choice;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DeadThread</span><span class="params">(<span class="keyword">int</span> choice,String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.choice=choice;</span><br><span class="line">        <span class="keyword">this</span>.name=name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        makeup();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (choice==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (gun)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">"获得了----》"</span>+gun.name+<span class="string">"的锁"</span>);</span><br><span class="line">                <span class="comment">//当走在这里的时候，小王也拿到了doll的锁并没有释放，</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">synchronized</span> (doll)&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">"获得了----》"</span>+doll.name+<span class="string">"的锁"</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (doll)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">"获得了----》"</span>+doll.name+<span class="string">"的锁"</span>);</span><br><span class="line">                <span class="comment">//这里小明一开始就拿到了 gun的锁并没有释放，故就产生了死锁</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">synchronized</span> (gun)&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">"获得了----》"</span>+gun.name+<span class="string">"的锁"</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h5 id="死锁避免"   >
          <a href="#死锁避免" class="heading-link"><i class="fas fa-link"></i></a>死锁避免</h5>
      <p>产生死锁的四个必要条件：</p>
<ol>
<li><strong>互斥条件</strong>：一个资源每次只能被一个进程使用。</li>
<li><strong>请求与保持条件</strong>：一个进程因请求资源而阻塞时，对已获得的资源保持不放。</li>
<li><strong>不剥夺条件</strong> : 进程已获得的资源，在末使用完之前，不能强行剥夺。</li>
<li><strong>循环等待条件</strong> : 若干进程之间形成一种头尾相接的循环等待资源关系。</li>
</ol>
<p>上面列出了死锁的四个必要条件，我们只要想办法破其中的任意一个或多个条件就可以避免死锁发生</p>

        <h3 id="Lock（锁）"   >
          <a href="#Lock（锁）" class="heading-link"><i class="fas fa-link"></i></a>Lock（锁）</h3>
      <ul>
<li>从JDK 5.0开始，Java提供了更强大的线程同步机制——通过<strong>显式定义同步锁对象来实现同步</strong>。同步锁使用Lock对象充当</li>
<li>java.util.concurrent.locks.Lock接口是控制多个线程对共享资源进行访问的工具。锁提供了对共享资源的独占访问，<strong>每次只能有一个</strong>线程对Lock对象加锁，线<strong>程开始访问共享资源之前应先获得Lock对象</strong></li>
<li><strong>ReentrantLock （可重入锁</strong>）类实现了 Lock ，它拥有与 synchronized 相同的并发性和内存语义，在实现线程安全的控制中，比较常用的是ReentrantLock，可以显式加锁、释放锁</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLock</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      LockThread lockThread = <span class="keyword">new</span> LockThread();</span><br><span class="line">      <span class="keyword">new</span> Thread(lockThread).start();</span><br><span class="line">      <span class="keyword">new</span> Thread(lockThread).start();</span><br><span class="line">      <span class="keyword">new</span> Thread(lockThread).start();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LockThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> tickets = <span class="number">10</span>;</span><br><span class="line">   ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">if</span> (tickets &gt; <span class="number">0</span>) &#123;</span><br><span class="line">               System.out.println(Thread.currentThread().getName() + <span class="string">"----&gt;"</span> + tickets--);</span><br><span class="line">               Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">         &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h4 id="synchronized-与-Lock-的对比"   >
          <a href="#synchronized-与-Lock-的对比" class="heading-link"><i class="fas fa-link"></i></a>synchronized 与 Lock 的对比</h4>
      <ul>
<li>Lock是<strong>显式锁（手动开启和关闭锁</strong>，别忘记关闭锁）synchronized是隐式锁，出了<strong>作用域自动释放</strong></li>
<li><strong>Lock只有代码块锁</strong>，synchronized<strong>有代码块锁和方法锁</strong></li>
<li>使用Lock锁，JVM将花费较少的时间来调度线程，性能更好。并且具有更好的扩展性（提供更多的子类）</li>
<li>优先使用顺序：<ul>
<li>Lock &gt; 同步代码块（已经进入了方法体，分配了相应资源）&gt; 同步方法（在方法体之外）</li>
</ul>
</li>
</ul>

        <h2 id="线程协作"   >
          <a href="#线程协作" class="heading-link"><i class="fas fa-link"></i></a>线程协作</h2>
      
        <h3 id="线程通信"   >
          <a href="#线程通信" class="heading-link"><i class="fas fa-link"></i></a>线程通信</h3>
      <ul>
<li>应用场景 : 生产者和消费者问题<ul>
<li>假设仓库中只能存放一件产品 , 生产者将生产出来的产品放入仓库 , 消费者将仓库中产品取走消费 .</li>
<li>如果仓库中没有产品 , 则生产者将产品放入仓库 , 否则停止生产并等待 , 直到仓库中的产品被消费者取走为止 .</li>
<li>如果仓库中放有产品 , 则消费者可以将产品取走消费 , 否则停止消费并等待 ,直到仓库中再次放入产品为止。</li>
</ul>
</li>
</ul>
<p><strong>分析</strong>：</p>
<p><strong>这是一个线程同步问题 , 生产者和消费者共享同一个资源 , 并且生产者和消费者之 间相互依赖 , 互为条件 .</strong></p>
<ul>
<li>对于生产者 , 没有生产产品之前 , 要通知消费者等待 . 而生产了产品之后 , 又需要马上通知消费者消费</li>
<li>对于消费者 , 在消费之后 , 要通知生产者已经结束消费 , 需要生产新的产品以供消费.</li>
<li>产者消费者问题中 , 仅有synchronized是不够的</li>
<li>Snchronized 可阻止并发更新同一个共享资源 , <strong>实现了同步</strong></li>
<li>Snchronized <strong>不能</strong>用来实现不同线程之间的消息传递 (<strong>通信</strong>)</li>
</ul>

        <h3 id="Java多线程学习之wait、notify-notifyAll-详解"   >
          <a href="#Java多线程学习之wait、notify-notifyAll-详解" class="heading-link"><i class="fas fa-link"></i></a>Java多线程学习之wait、notify/notifyAll 详解</h3>
      <p>1、wait()、notify/notifyAll() 方法是Object的本地final方法，<strong>无法被重写</strong>。</p>
<p>2、<strong>wait()使当前线程阻塞，前提是 必须先获得锁</strong>，一般配合synchronized 关键字使用，即，一般在synchronized 同步代码块里使用 wait()、notify/notifyAll() 方法。</p>
<p>3、 由于 wait()、notify/notifyAll() 在synchronized 代码块执行，说明当前线程一定是获取了锁的。</p>
<p><strong>当线程执行wait()方法时候，会释放当前的锁，然后让出CPU，进入等待状态</strong>。</p>
<p><strong>只有当 notify/notifyAll() 被执行时候，才会唤醒一个或多个正处于等待状态的线程</strong>，然后继续往下执行，直到执行完synchronized 代码块的代码或是中途遇到wait() ，再次释放锁。</p>
<p>也就是说，<strong>notify/notifyAll() 的执行只是唤醒沉睡的线程，而不会立即释放锁</strong>，锁的释放要看代码块的具体执行情况。所以在编程中，尽量在使用了notify/notifyAll() 后立即退出临界区，以唤醒其他线程让其获得锁</p>
<p>4、wait() 需要被try catch包围，以便发生异常中断也可以使wait等待的线程唤醒。</p>
<p>5、<strong>notify 和wait 的顺序不能错，如果A线程先执行notify方法，B线程在执行wait方法，那么B线程是无法被唤醒的。</strong></p>
<p>6、notify 和 notifyAll的区别</p>
<p><strong>notify方法只唤醒一个等待（对象的）线程并使该线程开始执行</strong>。所以如果有多个线程等待一个对象，这个方法只会唤醒其中一个线程，选择哪个线程取决于操作系统对多线程管理的实现。<strong>notifyAll 会唤醒所有等待(对象的)线程</strong>，尽管哪一个线程将会第一个处理取决于操作系统的实现。<strong>如果当前情况下有多个线程需要被唤醒，推荐使用notifyAll 方法。比如在生产者-消费者里面的使用，每次都需要唤醒所有的消费者或是生产者，以判断程序是否可以继续往下执行。</strong></p>
<p>7、在多线程中要测试某个条件的变化，使用if 还是while？</p>
<p>　　要注意，<strong>notify唤醒沉睡的线程后线程会接着上次的执行继续往下执行。</strong>所以在进行条件判断时候，可以先把 wait 语句忽略不计来进行考虑；显然，要确保程序一定要执行，并且要保证程序直到满足一定的条件再执行，要<strong>使用while进行等待，直到满足条件才继续往下执行。</strong></p>

        <h3 id="解决方法"   >
          <a href="#解决方法" class="heading-link"><i class="fas fa-link"></i></a>解决方法</h3>
      
        <h4 id="1-管程法"   >
          <a href="#1-管程法" class="heading-link"><i class="fas fa-link"></i></a>1.管程法</h4>
      <p>并发协作模型 “ 生产者 / 消费者模式 ” —-&gt;管程法</p>
<p>生产者 : 负责生产数据的模块 (可能是方法 , 对象 , 线程 , 进程) ;</p>
<p>消费者 : 负责处理数据的模块 (可能是方法 , 对象 , 线程 , 进程) ;</p>
<p><strong>缓冲区</strong> : 消费者不能直接使用生产者的数据 , 他们之间有个 “ 缓冲区</p>
<p>生产者将生产好的数据放入缓冲区 , 消费者从缓冲区拿出数据</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestShoppig</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      SyContainer syContainer = <span class="keyword">new</span> SyContainer();</span><br><span class="line">      <span class="keyword">new</span> Product(syContainer).start();</span><br><span class="line">      <span class="keyword">new</span> Consumer(syContainer).start();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义两个线程 生产者 消费者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">   SyContainer syContainer;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">(SyContainer syContainer)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.syContainer=syContainer;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>.run();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">         syContainer.push(<span class="keyword">new</span> Chicken(i));</span><br><span class="line">         System.out.println(<span class="string">"生产了---&gt;"</span> + i);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">   SyContainer syContainer;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Consumer</span><span class="params">(SyContainer syContainer)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.syContainer=syContainer;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>.run();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">         Chicken pop = syContainer.pop();</span><br><span class="line">         System.out.println(<span class="string">"消费了"</span>+pop.count);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//鸡</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chicken</span> </span>&#123;</span><br><span class="line">   <span class="comment">//数量</span></span><br><span class="line">   <span class="keyword">int</span> count;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Chicken</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.count = id;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//盘子</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyContainer</span> </span>&#123;</span><br><span class="line">   <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">   <span class="comment">//一个盘子放10只鸡</span></span><br><span class="line">   Chicken[] chickens = <span class="keyword">new</span> Chicken[<span class="number">10</span>];</span><br><span class="line">   <span class="comment">//生产者 放入产品</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(Chicken chicken)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (count == chickens.length) &#123;</span><br><span class="line">         <span class="comment">//盘子已满 通知消费者消费,生产者等待</span></span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="comment">//未满 生产丢入盘子</span></span><br><span class="line">         chickens[count] = chicken;</span><br><span class="line">         count++;</span><br><span class="line">         <span class="comment">//通知消费者消费,唤醒消费者</span></span><br><span class="line">         <span class="keyword">this</span>.notifyAll();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//消费者消费产品</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> Chicken <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="comment">//盘子为空，通知生产者生产,消费者等待\\</span></span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//可以消费</span></span><br><span class="line">      count--;</span><br><span class="line">      Chicken chicken = chickens[count];</span><br><span class="line">      <span class="keyword">this</span>.notifyAll();</span><br><span class="line">      <span class="keyword">return</span> chicken;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="信号灯法"   >
          <a href="#信号灯法" class="heading-link"><i class="fas fa-link"></i></a>信号灯法</h4>
      <p>并发协作模型 “ 生产者 / 消费者模式 ”</p>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTv</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Tv tv = <span class="keyword">new</span> Tv();</span><br><span class="line">      <span class="keyword">new</span> Thread(<span class="keyword">new</span> Player(tv)).start();</span><br><span class="line">      <span class="keyword">new</span> Thread(<span class="keyword">new</span> Watcher(tv)).start();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tv</span> </span>&#123;</span><br><span class="line">   <span class="comment">//演员表演 观众观看</span></span><br><span class="line">   <span class="keyword">private</span> String voice;</span><br><span class="line">   <span class="keyword">boolean</span> flag=<span class="keyword">true</span>;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(String voice)</span></span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (!flag)&#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(<span class="string">"表演了"</span>+voice);</span><br><span class="line">      <span class="comment">//唤醒观众去看</span></span><br><span class="line">      <span class="keyword">this</span>.notifyAll();</span><br><span class="line">      <span class="keyword">this</span>.flag=!<span class="keyword">this</span>.flag;</span><br><span class="line">      <span class="keyword">this</span>.voice=voice;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">watch</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (flag)&#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//等待演出</span></span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(<span class="string">"观看了---&gt;"</span>+voice);</span><br><span class="line">      <span class="keyword">this</span>.notifyAll();</span><br><span class="line">      <span class="keyword">this</span>.flag=!<span class="keyword">this</span>.flag;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//演出者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">   Tv tv;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Player</span><span class="params">(Tv tv)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.tv = tv;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">         <span class="keyword">if</span> (i%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">            tv.play(<span class="string">"光头强"</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         tv.play(<span class="string">"喜洋洋"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//观众</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">   Tv tv;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Watcher</span><span class="params">(Tv tv)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.tv = tv;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">         tv.watch();</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h4 id="线程池法"   >
          <a href="#线程池法" class="heading-link"><i class="fas fa-link"></i></a>线程池法</h4>
      <ul>
<li>背景：经常创建和销毁、使用量特别大的资源，比如并发情况下的线程，对性能影响很大。</li>
<li>思路：提前创建好多个线程，放入线程池中，使用时直接获取，使用完放回池中。</li>
<li>可以避免频繁创建销毁、实现重复利用。类似生活中的公共交通工具。</li>
<li>好处：<ul>
<li>提高响应速度（减少了创建新线程的时间）</li>
<li>降低资源消耗（重复利用线程池中线程，不需要每次都创建）</li>
<li>便于线程管理(….)<ul>
<li>corePoolSize：核心池的大小</li>
<li>maximumPoolSize：最大线程数</li>
<li>keepAliveTime：线程没有任务时最多保持多长时间后会终止</li>
</ul>
</li>
</ul>
</li>
<li>JDK 5.0起提供了线程池相关API：<strong>ExecutorService</strong> 和 <strong>Executors</strong></li>
<li>ExecutorService：<strong>真正的线程池接口</strong>。常见子类ThreadPoolExecutor<ul>
<li>void execute(Runnable command) ：执行任务/命令，没有返回值，一般用来执行Runnable</li>
<li><T> Future<T> submit(Callable<T> task)：执行任务，有返回值，一般又来执行Callable</li>
<li>void shutdown() ：关闭连接池</li>
</ul>
</li>
<li>Executors：<strong>工具类、线程池的工厂类，用于创建</strong>并返回不同类型的线程池</li>
</ul>
<figure class="highlight java"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPool</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//创建线程池 后面参数为线程池大小</span></span><br><span class="line">      ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">      executorService.execute(<span class="keyword">new</span> ThreadPool());</span><br><span class="line">      executorService.execute(<span class="keyword">new</span> ThreadPool());</span><br><span class="line">      executorService.execute(<span class="keyword">new</span> ThreadPool());</span><br><span class="line">      executorService.execute(<span class="keyword">new</span> ThreadPool());</span><br><span class="line">      executorService.execute(<span class="keyword">new</span> ThreadPool());</span><br><span class="line">      <span class="comment">//关闭连接</span></span><br><span class="line">      executorService.shutdown();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadPool</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">         System.out.println(Thread.currentThread().getName());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ END ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">Author: </span><span class="copyright-author__value"><a href="https://kingsirz123.github.io">源一</a></span></div><div class="copyright-link"><span class="copyright-link__name">Link: </span><span class="copyright-link__value"><a href="https://kingsirz123.github.io/2021/03/20/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/">https://kingsirz123.github.io/2021/03/20/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">Copyright: </span><span class="copyright-notice__value">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> unless stating additionally</span></div></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2021/03/21/Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">Lambda表达式</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2021/03/19/IO%E6%A1%86%E6%9E%B6/"><span class="paginator-prev__text">IO框架</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Catalog</span><span class="sidebar-nav-ov">Overview</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Java多线程"><span class="toc-number">1.</span> <span class="toc-text">
          Java多线程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Process与Thread"><span class="toc-number">1.0.1.</span> <span class="toc-text">
          Process与Thread</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#核心概念"><span class="toc-number">1.0.2.</span> <span class="toc-text">
          核心概念</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#线程创建"><span class="toc-number">1.1.</span> <span class="toc-text">
          线程创建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#方式一："><span class="toc-number">1.1.1.</span> <span class="toc-text">
          方式一：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#练习Thread，实现多线程同步下载图片"><span class="toc-number">1.1.2.</span> <span class="toc-text">
          练习Thread，实现多线程同步下载图片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#方式2："><span class="toc-number">1.1.3.</span> <span class="toc-text">
          方式2：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多个线程操作同一个对象"><span class="toc-number">1.1.4.</span> <span class="toc-text">
          多个线程操作同一个对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#龟兔赛跑"><span class="toc-number">1.1.5.</span> <span class="toc-text">
          龟兔赛跑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现Callable-了解"><span class="toc-number">1.1.6.</span> <span class="toc-text">
          实现Callable(了解)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#静态代理"><span class="toc-number">1.2.</span> <span class="toc-text">
          静态代理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#静态代理模式总结："><span class="toc-number">1.2.0.1.</span> <span class="toc-text">
          静态代理模式总结：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#线程方法"><span class="toc-number">1.3.</span> <span class="toc-text">
          线程方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#停止线程"><span class="toc-number">1.3.1.</span> <span class="toc-text">
          停止线程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#线程休眠"><span class="toc-number">1.3.2.</span> <span class="toc-text">
          线程休眠</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#线程礼让"><span class="toc-number">1.3.3.</span> <span class="toc-text">
          线程礼让</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#join"><span class="toc-number">1.3.4.</span> <span class="toc-text">
          join</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#线程状态"><span class="toc-number">1.4.</span> <span class="toc-text">
          线程状态</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#线程优先级"><span class="toc-number">1.4.1.</span> <span class="toc-text">
          线程优先级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#守护（daemon）线程"><span class="toc-number">1.4.2.</span> <span class="toc-text">
          守护（daemon）线程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#线程同步"><span class="toc-number">1.5.</span> <span class="toc-text">
          线程同步</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#并发和并行"><span class="toc-number">1.5.1.</span> <span class="toc-text">
          并发和并行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#线程同步-1"><span class="toc-number">1.5.2.</span> <span class="toc-text">
          线程同步</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#同步方法"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">
          同步方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#同步块"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">
          同步块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#线程同步安全"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">
          线程同步安全</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#买票"><span class="toc-number">1.5.2.3.1.</span> <span class="toc-text">
          买票</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#取钱（ACID补充）"><span class="toc-number">1.5.2.3.2.</span> <span class="toc-text">
          取钱（ACID补充）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ArrayList"><span class="toc-number">1.5.2.3.3.</span> <span class="toc-text">
          ArrayList</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CopyOnWriteArrayList-线程安全"><span class="toc-number">1.5.2.4.</span> <span class="toc-text">
          CopyOnWriteArrayList 线程安全</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#死锁"><span class="toc-number">1.5.2.5.</span> <span class="toc-text">
          死锁</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#死锁避免"><span class="toc-number">1.5.2.5.1.</span> <span class="toc-text">
          死锁避免</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lock（锁）"><span class="toc-number">1.5.3.</span> <span class="toc-text">
          Lock（锁）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#synchronized-与-Lock-的对比"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">
          synchronized 与 Lock 的对比</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#线程协作"><span class="toc-number">1.6.</span> <span class="toc-text">
          线程协作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#线程通信"><span class="toc-number">1.6.1.</span> <span class="toc-text">
          线程通信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java多线程学习之wait、notify-notifyAll-详解"><span class="toc-number">1.6.2.</span> <span class="toc-text">
          Java多线程学习之wait、notify&#x2F;notifyAll 详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解决方法"><span class="toc-number">1.6.3.</span> <span class="toc-text">
          解决方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-管程法"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">
          1.管程法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#信号灯法"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">
          信号灯法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#线程池法"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">
          线程池法</span></a></li></ol></li></ol></li></ol></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/3.jpeg" alt="avatar"></div><p class="sidebar-ov-author__text">一生中你唯一需要回头的时候，是为了看自己到底走了多远。</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/KingSirZ123/" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="https://plus.google.com/" target="_blank" rel="noopener" data-popover="Google" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-google"></i></span></a><a class="sidebar-ov-social-item" href="https://twitter.com/" target="_blank" rel="noopener" data-popover="Twitter" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-twitter"></i></span></a><a class="sidebar-ov-social-item" href="https://youtube.com/" target="_blank" rel="noopener" data-popover="Youtube" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-youtube"></i></span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">46</div><div class="sidebar-ov-state-item__name">Archives</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">Categories</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">Tags</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">You have read </span><span class="sidebar-reading-info__num">0</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2020.7.19~2021</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>你好世界</span></div><div><span>Theme - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.1.1</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.1.1"></script><script src="/js/stun-boot.js?v=2.1.1"></script><script src="/js/scroll.js?v=2.1.1"></script><script src="/js/header.js?v=2.1.1"></script><script src="/js/sidebar.js?v=2.1.1"></script></body></html>